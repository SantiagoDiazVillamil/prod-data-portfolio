{% extends "base.html" %}
{% block title %}RAC Enron{% endblock %}

{% block content %}
  <h2>Asistente empresarial</h2>

  <p><strong>쯈ui칠n responde cuando nadie sabe?</strong>  
  En muchas empresas, el conocimiento est치 disperso entre correos, documentos y personas que ya no est치n en la organizaci칩n. 쯏 si cada correo, cada decisi칩n, cada conversaci칩n pudiera convertirse en inteligencia empresarial?</p>

  <p><em>RAC Enron</em> es un asistente inteligente que demuestra c칩mo la inteligencia artificial puede recuperar, comprender y sintetizar el conocimiento organizacional. A partir de m치s de <strong>600,000 correos reales</strong> del caso Enron, este sistema responde preguntas complejas, identifica responsables clave y reconstruye el contexto de decisiones empresariales con precisi칩n.</p>

  <p><strong>Esta arquitectura no depende del caso Enron</strong>. Puede adaptarse a cualquier empresa, permitiendo que el asistente aprenda de sus correos, documentos y procesos internos. As칤, se convierte en una fuente confiable de conocimiento institucional, 칰til para <em>capacitaci칩n, toma de decisiones, auditor칤a y estandarizaci칩n de procesos</em>.</p>

  <p><strong>쮺칩mo funciona?</strong>  
  RAG combina t칠cnicas de recuperaci칩n aumentada por contenido, modelos de Embedding (tokenizaci칩n de palabras), b칰squeda vectorial y generaci칩n de lenguaje natural. El usuario formula una pregunta, el sistema busca los correos m치s relevantes en la base de datos, y luego genera una respuesta contextualizada usando modelos de 칰ltima generaci칩n.</p>

  <p><em>Este asistente no solo responde preguntas. Aprende de la historia de la empresa para dar soporte y agilidad en los procesos.</em></p>

  <hr>

  <div class="enronai-container">
    <div class="enronai-form">
      <!-- 游댢 MODIFICACI칍N 1: Se elimin칩 method="POST" y action="/enronai" para evitar que el formulario se env칤e al servidor y recargue la p치gina -->
      <form id="enronai-form">
        <label for="user-query"><strong>Interact칰a con EnronAi:</strong></label><br>
        <input type="text" id="user-query" name="user_query"
               class="enronai-input"
               placeholder="Ask EnronAi / Preg칰ntale a EnronAi"
               onfocus="this.placeholder=''" onblur="this.placeholder='Ask EnronAi / Preg칰ntale a EnronAi'">
        <!-- 游댢 MODIFICACI칍N 2: Se cambi칩 type="submit" por type="button" para evitar el env칤o autom치tico del formulario -->
        <button type="button" id="enronai-button" class="enronai-button">Preguntar</button>
      </form>
    </div>

    <div class="enronai-response">
      <strong>Respuesta de EnronAi:</strong><br>
      <!-- 游댢 MODIFICACI칍N 3: Se encapsul칩 la respuesta en un <p> con id="response-text" para que el script pueda actualizar el contenido din치micamente -->
      <p id="response-text">EnronAi will answer here / EnronAi responder치 aqu칤</p>
    </div>
  </div>

  <!-- 游댢 MODIFICACI칍N 4: Script incluido directamente en esta plantilla, dentro del bloque content, para mantener todo en EnronAi.html -->
  <script>
    document.addEventListener('DOMContentLoaded', function () {
      const button = document.getElementById('enronai-button');
      const input = document.getElementById('user-query');
      const output = document.getElementById('response-text');

      if (button && input && output) {
        button.addEventListener('click', async function (event) {
          event.preventDefault(); // 游댢 MODIFICACI칍N 5: Previene el comportamiento por defecto del bot칩n dentro del formulario

          const query = input.value.trim();
          if (!query) return;

          const encodedQuery = encodeURIComponent(query);
          const endpoint = `https://enron-microservice-934190760998.us-east1.run.app/search?query=${encodedQuery}&k=5`;

          try {
            const response = await fetch(endpoint);
            const data = await response.json();
            output.textContent = data.answer || 'No se recibi칩 respuesta.';
          } catch (error) {
            output.textContent = 'Error al conectar con EnronAi.';
            console.error('Error:', error);
          }
        });
      }
    });
  </script>
{% endblock %}
