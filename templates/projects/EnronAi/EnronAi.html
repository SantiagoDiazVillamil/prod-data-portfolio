{% extends "base.html" %}
{% block title %}RAC Enron{% endblock %}

{% block content %}
  
<details open class="enronai-details">
  <summary class="enronai-summary"><em>Asistente empresarial EnronAi</em></summary>
  <p>
<hr>
  <details open><summary>Prop√≥sito y aplicaci√≥n</summary>
  <p><p><p><strong>¬øPor qu√© las empresas ralentizan la toma de decisiones?</strong>  
  En muchas empresas, el conocimiento est√° disperso entre correos, documentos y personas dentro y fuera de la organizaci√≥n.</p></p></p>

 <div class="enronai-image-container">
    <img src="{{ url_for('static', filename='images/RAG.png') }}" alt="Arquitectura RAG" style="max-width:600px; width:100%; height:auto; display:block; margin:20px auto;">
  </div>
<br>
  <p><em>EnronAi</em> es un asistente inteligente que demuestra que la documentaci√≥n de procesos, correos y organigramas  de una empresa pueden ser insumo para que la inteligencia artificial pueda recuperar, comprender y sintetizar el conocimiento organizacional.

  <p><strong>Esta arquitectura no depende del caso Enron</strong>. Puede adaptarse a cualquier empresa, permitiendo que el asistente aprenda de sus correos, documentos y procesos internos. As√≠, se convierte en una fuente confiable de conocimiento institucional, √∫til para <em>gesti√≥n del conocimiento, toma de decisiones, estandarizaci√≥n de procesos y capacitaci√≥n</em>.
</details>

  <hr>

  <details open><summary>Prueba la soluci√≥n</summary>
    <br>
    Prueba con preguntas como:
    <div>
  <ul>
    <li>¬øQui√©n fue el CEO de Enron?</li>
    <li>¬øCu√°les eran los productos o servicios ofrecidos por Enron?</li>
    <li>¬øEn qu√© a√±o se fund√≥ la empresa?</li>
  </ul>
</div>

<!-- <div id="loading-message" class="loading-message">üîÑ Preparando EnronAi‚Ä¶</div> -->
 <pre id="battery-loader" class="battery-loader"></pre>

  <div class="enronai-container">
    <div class="enronai-form">
      <form id="enronai-form">
        <label for="user-query"><strong>Interact√∫a con EnronAi:</strong></label><br>
        <input type="text" id="user-query" name="user_query"
               class="enronai-input"
               placeholder="Ask EnronAi in any language/ Preg√∫ntale a EnronAi en cualquier idioma"
               onfocus="this.placeholder=''" onblur="this.placeholder='Ask EnronAi / Preg√∫ntale a EnronAi'">
        <button type="submit" id="enronai-button" class="enronai-button">Preguntar</button>
      </form>
    </div>

    <div class="enronai-response">
      <strong>Respuesta de EnronAi:</strong><br>
      <p id="response-text">EnronAi will answer here / EnronAi responder√° aqu√≠</p>
    </div>
  </div>


<!-- <script>
  function markdownToHTML(text) {
    let html = text.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
    html = html.replace(/^\* /gm, '‚Ä¢ ');
    return html;
  }

  document.addEventListener('DOMContentLoaded', function () {
    const battery = document.getElementById('battery-loader');
    const formContainer = document.querySelector('.enronai-container');
    const loadingMessage = document.getElementById('loading-message');

    // üîã Animaci√≥n de bater√≠a hasta 100%
    const frames = [];
    for (let i = 1; i <= 10; i++) {
      const fill = '‚ñà'.repeat(i);
      const empty = ' '.repeat(10 - i);
      const percent = i * 10;
  const frame = `
‚ï≠‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ïÆ
‚îÇ  [${fill}${empty}] ‚îÇ
‚îÇ      ${percent}%      ‚îÇ
‚ï∞‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ïØ
`;
      frames.push(frame);
    }

    let index = 0;
    const interval = setInterval(() => {
      battery.textContent = frames[index];
      index++;
      if (index >= frames.length) {
        clearInterval(interval);
        battery.textContent = frames[frames.length - 1]; // Mantener en 100%
        checkMicroserviceReady(); // ‚è≥ Esperar respuesta 200
      }
    }, 4500);

    // ‚úÖ Esperar respuesta 200 antes de mostrar la herramienta
    async function checkMicroserviceReady() {
      try {
        const response = await fetch('https://enron-microservice-934190760998.us-east1.run.app/start');
        if (response.ok && formContainer) {
          formContainer.style.display = 'block';
          if (loadingMessage) loadingMessage.style.display = 'none';
          if (battery) battery.style.display = 'none';
        } else {
          battery.textContent = '‚ö†Ô∏è EnronAi no est√° disponible. Reintentando...';
          setTimeout(checkMicroserviceReady, 2000); // üîÅ Reintenta cada 2 segundos
        }
      } catch (error) {
        console.error('Error al verificar el estado del microservicio:', error);
        battery.textContent = '‚ö†Ô∏è Error de conexi√≥n. Reintentando...';
        setTimeout(checkMicroserviceReady, 3000); // üîÅ Reintenta con espera
      }
    }

    // ‚úÖ Inicializar l√≥gica del formulario
    const form = document.getElementById('enronai-form');
    const input = document.getElementById('user-query');
    const output = document.getElementById('response-text');
    const button = document.getElementById('enronai-button');

    if (form && input && output && button) {
      form.addEventListener('submit', async function (event) {
        event.preventDefault();

        const query = input.value.trim();
        if (!query) return;

        button.disabled = true;
        button.textContent = "Consultando‚Ä¶";

        const endpoint = `https://enron-microservice-934190760998.us-east1.run.app/search?query=${encodeURIComponent(query)}&k=30`;

        try {
          const response = await fetch(endpoint);
          const data = await response.json();
          const html_response_gemini = markdownToHTML(data.gemini) || 'No se recibi√≥ respuesta.';
          output.innerHTML = html_response_gemini;
        } catch (error) {
          output.textContent = 'Error al conectar con EnronAi.';
          console.error('Error:', error);
        } finally {
          button.disabled = false;
          button.textContent = "Preguntar";
        }
      });
    }
  });
</script> -->



<script>
  function markdownToHTML(text) {
    let html = text.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
    html = html.replace(/^\* /gm, '‚Ä¢ ');
    return html;
  }

  document.addEventListener('DOMContentLoaded', function () {
    const battery = document.getElementById('battery-loader');
    const formContainer = document.querySelector('.enronai-container');
    const loadingMessage = document.getElementById('loading-message');

    const frames = [];
    for (let i = 1; i <= 10; i++) {
      const fill = '‚ñà'.repeat(i);
      const empty = ' '.repeat(10 - i);
      const percent = i * 10;
      const frame = `
‚ï≠‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ïÆ
‚îÇ  [${fill}${empty}] ‚îÇ
‚îÇ      ${percent}%      ‚îÇ
‚ï∞‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ïØ
`;
      frames.push(frame);
    }

    let index = 0;
    let intervalSpeed = 4500; // velocidad normal
    let interval;

    let microserviceReady = false;

    function startBatteryAnimation() {
      interval = setInterval(() => {
        battery.textContent = frames[index];
        index++;

        if (index >= frames.length) {
          clearInterval(interval);
          battery.textContent = frames[frames.length - 1];
          if (microserviceReady) showInterface();
        }
      }, intervalSpeed);
    }

    async function checkMicroserviceReady() {
      try {
        const response = await fetch('https://enron-microservice-934190760998.us-east1.run.app/start');
        if (response.ok && formContainer) {
          microserviceReady = true;

          // ‚úÖ OPCI√ìN 1: completar la bater√≠a inmediatamente
          if (index < frames.length) {
            clearInterval(interval);
            battery.textContent = frames[frames.length - 1];
            showInterface();
          }

          // ‚úÖ OPCI√ìN 2: acelerar la animaci√≥n si a√∫n no termin√≥
          // if (index < frames.length) {
          //   clearInterval(interval);
          //   intervalSpeed = 100; // velocidad r√°pida
          //   startBatteryAnimation();
          // } else {
          //   showInterface();
          // }
        } else {
          battery.textContent = '‚ö†Ô∏è EnronAi no est√° disponible. Reintentando...';
          setTimeout(checkMicroserviceReady, 2000);
        }
      } catch (error) {
        console.error('Error al verificar el estado del microservicio:', error);
        battery.textContent = '‚ö†Ô∏è Error de conexi√≥n. Reintentando...';
        setTimeout(checkMicroserviceReady, 3000);
      }
    }

    function showInterface() {
      formContainer.style.display = 'block';
      if (loadingMessage) loadingMessage.style.display = 'none';
      if (battery) battery.style.display = 'none';
    }

    startBatteryAnimation();
    checkMicroserviceReady();

    const form = document.getElementById('enronai-form');
    const input = document.getElementById('user-query');
    const output = document.getElementById('response-text');
    const button = document.getElementById('enronai-button');

    if (form && input && output && button) {
      form.addEventListener('submit', async function (event) {
        event.preventDefault();

        const query = input.value.trim();
        if (!query) return;

        button.disabled = true;
        button.textContent = "Consultando‚Ä¶";

        const endpoint = `https://enron-microservice-934190760998.us-east1.run.app/search?query=${encodeURIComponent(query)}&k=30`;

        try {
          const response = await fetch(endpoint);
          const data = await response.json();
          const html_response_gemini = markdownToHTML(data.gemini) || 'No se recibi√≥ respuesta.';
          output.innerHTML = html_response_gemini;
        } catch (error) {
          output.textContent = 'Error al conectar con EnronAi.';
          console.error('Error:', error);
        } finally {
          button.disabled = false;
          button.textContent = "Preguntar";
        }
      });
    }
  });
</script>





  </details>

<hr>

<details><summary>Orquestaci√≥n y ecosistema de herramientas utilizadas</summary>
  <p><strong>EnronAi: arquitectura modular para recuperaci√≥n aumentada con IA</strong></p>

  <p>La arquitectura de EnronAi se basa en un pipeline robusto que combina procesamiento masivo, vectorizaci√≥n sem√°ntica y generaci√≥n contextual. Estos son los componentes clave que intervienen en el proceso:</p>

  <ul>
    <li><strong>Preprocesamiento y vectorizaci√≥n</strong><br>
      M√°quina Virtual en Google Cloud: limpieza de datos con Pandas, eliminaci√≥n de ruido y normalizaci√≥n textual.<br>
      SentenceTransformer: convierte correos en vectores sem√°nticos listos para b√∫squeda.
    </li>
    <br>
    <li><strong>Indexaci√≥n y almacenamiento</strong><br>
      FAISS: genera √≠ndices vectoriales optimizados para b√∫squedas por distancia euclidiana.<br>
      Cloud Storage: almacena embeddings, correos y modelos preentrenados.
    </li>
    <br>
    <li><strong>Microservicio inteligente</strong><br>
      Cloud Run: recibe la consulta, la vectoriza, busca los k correos m√°s relevantes y los env√≠a a Gemini.<br>
      Gemini API: genera respuestas contextualizadas, traducidas y optimizadas para el idioma del usuario.
    </li>
    <br>
    <li><strong>Despliegue y consumo</strong><br>
      Interfaz web: HTML + JS para interacci√≥n directa.<br>
      GitHub + Cloud Build: versionamiento y CI/CD.<br>
      Artifact Registry: contenedor con dependencias, modelo y base vectorial.
    </li>
  </ul>


  <p><strong>Ecosistema de herramientas utilizadas</strong></p>
  <p>Estas aplicaciones fueron utilizadas durante eldesarrollo. Cada una cumple un rol clave para la generaci√≥n inteligente de respuestas:</p>

  <div class="tech-collage-container">
    <img src="{{ url_for('static', filename='images/Enron_apps_python.png') }}" alt="Python" class="tech-logo">
    <img src="{{ url_for('static', filename='images/Enron_apps_faiss.jpeg') }}" alt="FAISS" class="tech-logo">
    <img src="{{ url_for('static', filename='images/Enron_apps_cloud_Storage.png') }}" alt="Cloud Storage" class="tech-logo">
    <img src="{{ url_for('static', filename='images/Enron_apps_github.png') }}" alt="GitHub" class="tech-logo">
    <img src="{{ url_for('static', filename='images/Enron_apps_cloud_build.png') }}" alt="Cloud Build" class="tech-logo">
    <img src="{{ url_for('static', filename='images/Enron_apps_artifact_Registry.png') }}" alt="Artifact Registry" class="tech-logo">
    <img src="{{ url_for('static', filename='images/Enron_apps_compute_engine.png') }}" alt="Compute Engine" class="tech-logo">
    <img src="{{ url_for('static', filename='images/Enron_apps_gemini_api.png') }}" alt="Gemini" class="tech-logo">
    <img src="{{ url_for('static', filename='images/Enron_apps_Sentence_Transformers.png') }}" alt="SBERT / HuggingFace" class="tech-logo">
    <img src="{{ url_for('static', filename='images/Enron_apps_cloud_run_flask.png') }}" alt="Flask + Cloud Functions + Firestore" class="tech-logo">
  </div>


</details>
<hr>
<details open><summary>Detalles, desde la idea hasta el despliegue</summary>
<br>
  <p><strong>El recorrido t√©cnico detr√°s de EnronAi</strong></p>

  <p>EnronAi fue desarrollado en distintas etapas, integrando m√∫ltiples herramientas que aportaron valor en cada fase. A continuaci√≥n, se detalla el proceso completo desde la concepci√≥n hasta el despliegue:</p>

  <ul>
    <li><strong>1. Selecci√≥n del caso y definici√≥n del enfoque</strong><br>
      La idea inicial era clara: construir un asistente inteligente potenciado por IA, orientado a apoyar procesos internos empresariales. Para ello, se requer√≠a una base de datos p√∫blica que reflejara decisiones, comunicaciones y din√°micas organizacionales. El dataset de Enron result√≥ ser el m√°s adecuado, al contener miles de correos que, aunque no incluyen documentos formales ni organigramas, ofrecen una visi√≥n valiosa de las interacciones internas de la compa√±√≠a.
    </li>
    <br>
    <li><strong>2. Preprocesamiento de datos</strong><br>
      En una m√°quina virtual de Google Cloud, se utiliz√≥ Python con las librer√≠as Pandas y NumPy para limpiar el corpus: se eliminaron correos basura, s√≠mbolos irrelevantes, duplicados y mensajes generados por bots. Este paso fue esencial para garantizar coherencia sem√°ntica y relevancia contextual.
    </li>
    <br>
    <li><strong>3. Vectorizaci√≥n sem√°ntica</strong><br>
      Se aplic√≥ SentenceTransformer (SBERT) para convertir cada correo en un vector de significado. Esto permiti√≥ realizar b√∫squedas contextuales basadas en similitud sem√°ntica, en lugar de coincidencias literales.
    </li>
    <br>
    <li><strong>4. Indexaci√≥n y almacenamiento</strong><br>
      FAISS se utiliz√≥ para construir una base vectorial eficiente, optimizada para b√∫squedas por distancia euclidiana. Los vectores, correos y el modelo preentrenado se almacenaron en Google Cloud Storage, permitiendo acceso r√°pido y seguro desde otros servicios.
    </li>
    <br>
    <li><strong>5. Construcci√≥n del microservicio</strong><br>
      Se desarroll√≥ un microservicio en Flask, desplegado en Cloud Run, que expone un endpoint HTTP optimizado para consultas GET. Este endpoint recibe dos par√°metros: la pregunta del usuario (query) y el n√∫mero de resultados deseados (k). Internamente, la consulta se traduce al ingl√©s si es necesario, se vectoriza, y se ejecuta una b√∫squeda en la base FAISS. Los vectores m√°s relevantes se env√≠an a Gemini mediante su API, y la respuesta generada se traduce nuevamente al idioma original antes de ser entregada al usuario.
    </li>
    <br>
    <li><strong>6. Exposici√≥n como servicio</strong><br>
      El microservicio fue desplegado en Cloud Run, lo que permiti√≥ escalar la soluci√≥n y consumirla desde una interfaz web. Se garantiz√≥ disponibilidad, eficiencia y bajo tiempo de respuesta.
    </li>
    <br>
    <li><strong>7. Automatizaci√≥n y despliegue continuo</strong><br>
      Se integr√≥ GitHub para el versionamiento del c√≥digo, Cloud Build para la automatizaci√≥n del despliegue, y Artifact Registry como repositorio central de contenedores.
    </li>
    <br>
    <li><strong>8. Interfaz de usuario</strong><br>
      Se dise√±√≥ una p√°gina web responsiva que permite interactuar con EnronAi en cualquier idioma. La interfaz es intuitiva, clara y refleja el prop√≥sito del asistente: recuperar, comprender y sintetizar conocimiento empresarial de forma accesible.
    </li>
  </ul>

  <p><em>Este recorrido t√©cnico, junto con las capacidades el√°sticas de Google Cloud, permitieron orquestar de manera eficiente las m√∫ltiples tecnolog√≠as involucradas para concluir con √©xito este proyecto.</em></p>
</details>



</details>
{% endblock %}
